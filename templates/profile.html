{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block title %}My Profile - QuickMeds{% endblock %}

{% block extra_css %}
<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body { background: #f5f6fa; font-family: 'Segoe UI', system-ui, sans-serif; }
    
    .profile-container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
    
    .profile-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 40px 30px;
        border-radius: 16px;
        color: white;
        margin-bottom: 30px;
        box-shadow: 0 8px 24px rgba(102,126,234,0.15);
        display: flex;
        align-items: center;
        gap: 25px;
    }
    
    .avatar { width: 90px; height: 90px; border-radius: 50%; background: white; 
        display: flex; align-items: center; justify-content: center; font-size: 36px; 
        color: #667eea; border: 4px solid rgba(255,255,255,0.3); flex-shrink: 0; }
    
    .avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
    
    .profile-header h1 { font-size: 28px; margin-bottom: 8px; font-weight: 700; }
    
    .profile-header p { opacity: 0.95; margin: 4px 0; }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
    
    .tabs button { padding: 14px 24px; background: none; border: none; 
        border-bottom: 3px solid transparent; cursor: pointer; font-size: 15px; 
        font-weight: 500; color: #666; transition: all 0.2s; }
    
    .tabs button:hover { color: #667eea; }
    
    .tabs button.active { color: #667eea; border-bottom-color: #667eea; }
    
    .tabs .logout-btn { margin-left: auto; color: #dc3545; }
    
    .tab-panel { display: none; }
    
    .tab-panel.active { display: block; }
    
    .card { background: white; padding: 25px; border-radius: 12px; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 20px; }
    
    .card h3 { font-size: 20px; margin-bottom: 20px; display: flex; 
        align-items: center; gap: 10px; color: #333; }
    
    .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 18px; }
    
    .info-item { padding: 16px; background: #f8f9fa; border-radius: 10px; }
    
    .info-label { display: block; font-size: 13px; color: #888; margin-bottom: 6px; font-weight: 500; }
    
    .info-value { display: block; font-size: 16px; color: #333; font-weight: 600; }
    
    .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; 
        font-size: 15px; font-weight: 500; display: inline-flex; align-items: center; 
        gap: 8px; transition: all 0.2s; text-decoration: none; }
    
    .btn-primary { background: #667eea; color: white; }
    
    .btn-primary:hover { background: #5568d3; transform: translateY(-1px); 
        box-shadow: 0 4px 12px rgba(102,126,234,0.25); }
    
    .btn-secondary { background: #6c757d; color: white; padding: 10px 18px; font-size: 14px; }
    
    .btn-danger { background: #dc3545; color: white; }
    
    .order-item { background: white; padding: 18px; border-radius: 10px; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.06); margin-bottom: 12px; }
    
    .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    
    .order-header strong { font-size: 16px; }
    
    .badge { padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    
    .badge-success { background: #28a745; color: white; }
    
    .badge-danger { background: #dc3545; color: white; }
    
    .badge-warning { background: #ffc107; color: #333; }
    
    .order-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 12px; }
    
    .order-footer .price { font-size: 20px; font-weight: 700; color: #667eea; }
    
    .address-item { background: white; padding: 20px; border-radius: 10px; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.06); margin-bottom: 15px; position: relative; }
    
    .address-item .default-badge { position: absolute; top: 15px; right: 15px; 
        background: #28a745; color: white; padding: 4px 10px; border-radius: 12px; 
        font-size: 11px; font-weight: 600; }
    
    .address-item h4 { font-size: 17px; margin: 8px 0; }
    
    .address-item p { color: #666; margin: 4px 0; }
    
    .address-actions { margin-top: 12px; display: flex; gap: 8px; }
    
    .empty-state { text-align: center; padding: 60px 20px; }
    
    .empty-state i { font-size: 64px; color: #ddd; margin-bottom: 16px; }
    
    .empty-state p { color: #999; font-size: 16px; margin-bottom: 18px; }
    
    .form-group { margin-bottom: 16px; }
    
    .form-group label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px; color: #555; }
    
    .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
        font-size: 15px; transition: all 0.2s; }
    
    .form-control:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
    
    @media (max-width: 768px) {
        .profile-header { flex-direction: column; text-align: center; padding: 30px 20px; }
        .tabs { overflow-x: auto; white-space: nowrap; }
        .info-grid { grid-template-columns: 1fr; }
        .order-header, .order-footer { flex-direction: column; align-items: flex-start; gap: 10px; }
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-container">
    <!-- Header -->
    <div class="profile-header">
        <div class="avatar">
            {% if user.userprofile.profile_image %}
            <img src="{{ user.userprofile.profile_image.url }}" alt="Profile">
            {% else %}
            <i class="fas fa-user"></i>
            {% endif %}
        </div>
        <div>
            <h1>{{ user.get_full_name|default:user.username }}</h1>
            <p><i class="fas fa-envelope"></i> {{ user.email }}</p>
            <p><i class="fas fa-calendar"></i> Member since {{ user.date_joined|date:"F Y" }}</p>
        </div>
    </div>
    
    <!-- Tabs -->
    <div class="tabs">
        <button class="active" onclick="showTab('info')"><i class="fas fa-user"></i> Info</button>
        <button onclick="showTab('orders')"><i class="fas fa-shopping-bag"></i> Orders {% if orders_count %}({{ orders_count }}){% endif %}</button>
        <button onclick="showTab('addresses')"><i class="fas fa-map-marker-alt"></i> Addresses</button>
        <button onclick="showTab('settings')"><i class="fas fa-cog"></i> Settings</button>
        <button class="logout-btn" onclick="location.href='{% url 'logout' %}'"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
    
    <!-- Info Tab -->
    <div id="info" class="tab-panel active">
        <div class="card">
            <h3><i class="fas fa-user-circle"></i> Personal Information</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Full Name</span>
                    <span class="info-value">{{ user.get_full_name|default:"Not set" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email</span>
                    <span class="info-value">{{ user.email }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Phone</span>
                    <span class="info-value">{{ user.userprofile.phone|default:"Not set" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Gender</span>
                    <span class="info-value">
                        {% if user.userprofile.gender == 'M' %}Male
                        {% elif user.userprofile.gender == 'F' %}Female
                        {% elif user.userprofile.gender == 'O' %}Other
                        {% else %}Not set{% endif %}
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">Date of Birth</span>
                    <span class="info-value">{{ user.userprofile.dob|date:"F d, Y"|default:"Not set" }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Member Since</span>
                    <span class="info-value">{{ user.date_joined|date:"F Y" }}</span>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="alert('Edit feature coming soon!')">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>
        </div>
    </div>
    
    <!-- Orders Tab -->
    <div id="orders" class="tab-panel">
        <h2 style="margin-bottom: 20px;"><i class="fas fa-shopping-bag"></i> My Orders</h2>
        {% if orders %}
            {% for order in orders %}
            <div class="order-item">
                <div class="order-header">
                    <div>
                        <strong>Order #{{ order.id }}</strong>
                        <span style="color: #999; margin-left: 12px;">{{ order.created_at|date:"d M Y" }}</span>
                    </div>
                    <span class="badge {% if order.order_status == 'DELIVERED' %}badge-success{% elif order.order_status == 'CANCELLED' %}badge-danger{% else %}badge-warning{% endif %}">
                        {{ order.order_status }}
                    </span>
                </div>
                <div class="order-footer">
                    <div>
                        <p style="margin: 0; color: #666; font-size: 14px;">{{ order.items.count }} item(s)</p>
                        <p class="price">â‚¹{{ order.total_amount|intcomma }}</p>
                    </div>
                    <a href="{% url 'order_detail' order.id %}" class="btn btn-primary">
                        <i class="fas fa-eye"></i> View Details
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-shopping-bag"></i>
                <p>No orders yet</p>
                <a href="{% url 'product' %}" class="btn btn-primary">Start Shopping</a>
            </div>
        {% endif %}
    </div>
    
    <!-- Addresses Tab -->
    <div id="addresses" class="tab-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2><i class="fas fa-map-marker-alt"></i> My Addresses</h2>
            <button class="btn btn-primary" onclick="alert('Add address feature coming soon!')">
                <i class="fas fa-plus"></i> Add Address
            </button>
        </div>
        
        {% if addresses %}
            {% for address in addresses %}
            <div class="address-item">
                {% if address.is_default %}
                <span class="default-badge">DEFAULT</span>
                {% endif %}
                <div style="margin-bottom: 8px;">
                    <i class="fas fa-{% if address.type == 'Home' %}home{% elif address.type == 'Office' %}building{% else %}map-marker{% endif %}" style="color: #667eea; margin-right: 6px;"></i>
                    <strong>{{ address.type }}</strong>
                </div>
                <h4>{{ address.full_name }}</h4>
                <p>{{ address.phone_number }}</p>
                <p>{{ address.street_address }}</p>
                <p>{{ address.city }}, {{ address.state }} {{ address.postal_code }}</p>
                <div class="address-actions">
                    <button class="btn btn-secondary" onclick="alert('Edit feature coming soon!')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger" onclick="alert('Delete feature coming soon!')">
                        <i class="fas fa-trash"></i> Delete
                    </button>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-map-marker-alt"></i>
                <p>No addresses yet</p>
                <button class="btn btn-primary" onclick="alert('Add address feature coming soon!')">
                    <i class="fas fa-plus"></i> Add Your First Address
                </button>
            </div>
        {% endif %}
    </div>
    
    <!-- Settings Tab -->
    <div id="settings" class="tab-panel">
        <div class="card">
            <h3><i class="fas fa-lock"></i> Change Password</h3>
            <form style="max-width: 500px;">
                {% csrf_token %}
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" class="form-control" placeholder="Enter current password" autocomplete="current-password" name="current_password" required>
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" class="form-control" placeholder="Enter new password" autocomplete="new-password" name="new_password" required minlength="8">
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" class="form-control" placeholder="Confirm new password" autocomplete="new-password" name="confirm_password" required minlength="8">
                </div>
                <button type="button" class="btn btn-primary" onclick="alert('Password change feature coming soon!')">
                    <i class="fas fa-key"></i> Update Password
                </button>
            </form>
        </div>
        
        <div class="card" style="border: 2px solid #dc3545;">
            <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
            <p style="color: #666; margin-bottom: 15px;">Once you delete your account, there is no going back.</p>
            <button class="btn btn-danger" onclick="if(confirm('Are you sure?')) alert('Delete account feature coming soon!')">
                <i class="fas fa-trash-alt"></i> Delete Account
            </button>
        </div>
    </div>
</div>

<script>
function showTab(tabName) {
    // Hide all panels
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    
    // Remove active from all buttons
    document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
    
    // Show selected panel
    document.getElementById(tabName).classList.add('active');
    
    // Mark button as active
    event.target.classList.add('active');
}
</script>
{% endblock %}
